import{r as F,o as ee,a as te,d as ae,b as g,c as w,e as m,w as S,n as k,f as c,t as _,g as f,_ as v,h as I,u,i as A,j as E,v as N,k as V,F as G,l as K,m as se,p as ne,q as h,s as oe}from"./index-Df-YaTya.js";const T=767;function re(){const t=F(window.innerWidth),e=F(t.value<=T),n=()=>{t.value=window.innerWidth,e.value=t.value<=T};return ee(()=>window.addEventListener("resize",n)),te(()=>window.removeEventListener("resize",n)),{width:t,isMobile:e}}const z=-14,ie=-1,B=[{label:"MP3 (MPEG‑1 Layer III)",value:"mp3",mime:"audio/mpeg"},{label:"AAC / M4A",value:"m4a",mime:"audio/mp4"},{label:"WAV (PCM 16‑bit)",value:"wav",mime:"audio/wav"},{label:"FLAC (lossless)",value:"flac",mime:"audio/flac"},{label:"OGG (Vorbis)",value:"ogg",mime:"audio/ogg"}],b=ae("audio",{state:()=>({file:null,fileName:null,meta:null,gainDb:0,format:"wav",bitrateKbps:null,progress:0,loading:!1,error:null}),getters:{hasFile:t=>t.file!==null,loudnessDelta:t=>t.meta?z-t.meta.loudnessLUFS:0},actions:{reset(){this.$reset()},setFile(t){var a;this.file=t,this.fileName=t.name,this.error=null,this.progress=0;const e=((a=t.name.split(".").pop())==null?void 0:a.toLowerCase())||"",n=B.find(s=>s.value===e);n&&(this.format=n.value)},setMeta(t){this.meta=t,t.bitrateKbps&&(this.bitrateKbps=t.bitrateKbps)},setGainDb(t){this.gainDb=t},setFormat(t){this.format=t},setBitrate(t){this.bitrateKbps=t},setProgress(t){this.progress=t},setLoading(t){this.loading=t},setError(t){this.error=t}}}),le=g({__name:"FileDropZone",setup(t){const e=b(),n=F(!1),a=w(()=>e.hasFile?"Drop to replace or click to browse":"Drag & drop or click to browse");function s(i){n.value=i}function o(i){i&&(e.reset(),e.setFile(i))}function r(i){const d=i.target.files;d&&d[0]&&o(d[0])}function l(i){var y,D;n.value=!1;const d=(D=(y=i.dataTransfer)==null?void 0:y.files)==null?void 0:D[0];d&&o(d)}return(i,d)=>(f(),m("label",{class:k(["drop-zone",{dragging:n.value}]),onDragenter:d[0]||(d[0]=S(y=>s(!0),["prevent"])),onDragover:d[1]||(d[1]=S(()=>{},["prevent"])),onDragleave:d[2]||(d[2]=S(y=>s(!1),["prevent"])),onDrop:S(l,["prevent"])},[c("input",{class:"visually-hidden",type:"file",accept:"audio/*",onChange:r},null,32),c("p",null,_(a.value),1)],34))}}),ce=v(le,[["__scopeId","data-v-41eadbb0"]]);function ue(t){return Math.pow(10,t/20)}const p=new Audio;p.preload="auto";const x=new AudioContext,de=x.createMediaElementSource(p),W=x.createGain();de.connect(W).connect(x.destination);const q=b(),P=F(!1),Z=F(0),H=F(0);p.addEventListener("timeupdate",()=>Z.value=p.currentTime);p.addEventListener("loadedmetadata",()=>H.value=p.duration);p.addEventListener("play",()=>P.value=!0);p.addEventListener("pause",()=>P.value=!1);p.addEventListener("ended",()=>P.value=!1);let C=null;I(()=>q.file,t=>{C&&URL.revokeObjectURL(C),t?(C=URL.createObjectURL(t),p.src=C,p.load()):p.removeAttribute("src")});I(()=>q.gainDb,t=>W.gain.value=ue(t));function pe(){x.state!=="running"&&x.resume(),p.play()}function me(){p.pause()}function fe(){p.pause(),p.currentTime=0}function _e(t){p.currentTime=t}function X(){return{isPlaying:w(()=>P.value),currentTime:Z,duration:w(()=>H.value),play:pe,pause:me,stop:fe,seek:_e}}const ge={class:"bar"},ve=["disabled"],be=["disabled"],he=g({__name:"TransportBar",setup(t){const e=X(),n=b(),a=w(()=>e.isPlaying.value);function s(){a.value?e.pause():e.play()}function o(){e.stop()}return(r,l)=>(f(),m("div",ge,[c("button",{class:"btn",disabled:!u(n).hasFile,onClick:s,"aria-label":"Play or pause"},_(a.value?"Pause":"Play"),9,ve),c("button",{class:"btn",disabled:!u(n).hasFile,onClick:o,"aria-label":"Stop"}," Stop ",8,be)]))}}),we=v(he,[["__scopeId","data-v-900b1d40"]]),ye={key:0,class:"seek-wrap"},Fe=["max"],Le={class:"time"},De=g({__name:"SeekSlider",setup(t){const{currentTime:e,duration:n,seek:a}=X(),s=w({get:()=>e.value,set:r=>a(r)});function o(r){const l=Math.floor(r/60).toString().padStart(2,"0"),i=Math.floor(r%60).toString().padStart(2,"0");return`${l}:${i}`}return(r,l)=>u(n)>0?(f(),m("div",ye,[E(c("input",{type:"range",class:"seek",max:u(n),step:"0.01","onUpdate:modelValue":l[0]||(l[0]=i=>s.value=i),"aria-label":"Seek position"},null,8,Fe),[[N,s.value,void 0,{number:!0}]]),c("span",Le,_(o(s.value))+" / "+_(o(u(n))),1)])):A("",!0)}}),$e=v(De,[["__scopeId","data-v-098fdb06"]]),ke={class:"slider-wrap"},xe={class:"value"},Se=-24,Ce=24,Ee=g({__name:"VolumeSlider",setup(t){const e=b(),n=w({get:()=>e.gainDb,set:a=>e.setGainDb(a)});return(a,s)=>(f(),m("div",ke,[E(c("input",{type:"range",class:"slider",min:Se,max:Ce,step:"0.1","onUpdate:modelValue":s[0]||(s[0]=o=>n.value=o),"aria-label":"Volume gain in decibels"},null,512),[[N,n.value,void 0,{number:!0}]]),c("span",xe,_(n.value.toFixed(1))+" dB",1)]))}}),Pe=v(Ee,[["__scopeId","data-v-2af4aace"]]),Me=["value"],Ae=g({__name:"FormatSelect",setup(t){const e=b(),n=B,a=w({get:()=>e.format,set:s=>e.setFormat(s)});return(s,o)=>E((f(),m("select",{class:"select","onUpdate:modelValue":o[0]||(o[0]=r=>a.value=r),"aria-label":"Output format"},[(f(!0),m(G,null,K(u(n),r=>(f(),m("option",{key:r.value,value:r.value},_(r.label),9,Me))),128))],512)),[[V,a.value]])}}),Be=v(Ae,[["__scopeId","data-v-274aab60"]]),Te=[64,96,128,160,192,256,320],Re=["value"],Ue=g({__name:"BitrateSelect",setup(t){const e=b(),n=Te,a=w({get:()=>e.bitrateKbps,set:s=>{s===null?e.setBitrate(null):e.setBitrate(Number(s))}});return(s,o)=>E((f(),m("select",{class:"select","onUpdate:modelValue":o[0]||(o[0]=r=>a.value=r),"aria-label":"Bit‑rate (kbps)"},[o[1]||(o[1]=c("option",{value:null},"Original / Lossless",-1)),(f(!0),m(G,null,K(u(n),r=>(f(),m("option",{key:r,value:r},_(r)+" kbps ",9,Re))),128))],512)),[[V,a.value]])}}),Oe=v(Ue,[["__scopeId","data-v-02f967a0"]]);async function je(t){const e=await t.arrayBuffer(),a=await new OfflineAudioContext(2,1,44100).decodeAudioData(e),{numberOfChannels:s,length:o,sampleRate:r}=a,l=s===1?a.getChannelData(0):Ie(a);let i=0;for(let L=0;L<l.length;L++)i+=l[L]**2;i=Math.sqrt(i/l.length);const d=20*Math.log10(i)-.691;let y=0;for(let L=0;L<l.length;L++)y=Math.max(y,Math.abs(l[L]));const D=20*Math.log10(y),J=z-d,Q=ie-D,Y=Math.min(J,Q);return{integratedLufs:d,truePeakDbTP:D,gainDb:Y}}function Ie(t){const e=t.length,n=new Float32Array(e);for(let a=0;a<t.numberOfChannels;a++){const s=t.getChannelData(a);for(let o=0;o<e;o++)n[o]+=s[o]}for(let a=0;a<e;a++)n[a]/=t.numberOfChannels;return n}const Ne=["disabled"],Ve=g({__name:"AutoAdjustBtn",setup(t){const e=b();async function n(){if(e.file)try{e.setLoading(!0);const{integratedLufs:a,truePeakDbTP:s,gainDb:o}=await je(e.file);e.meta?e.setMeta({...e.meta,loudnessLUFS:a,truePeakDbTP:s}):e.setMeta({name:e.file.name,duration:0,sampleRate:0,channels:0,container:"",codec:"",bitrateKbps:null,loudnessLUFS:a,truePeakDbTP:s}),e.setGainDb(o)}catch(a){e.setError(a.message)}finally{e.setLoading(!1)}}return(a,s)=>(f(),m("button",{class:"btn",disabled:!u(e).hasFile||u(e).loading,onClick:n,"aria-label":"Auto adjust loudness"},_(u(e).loading?"Analysing…":"Auto Adjust"),9,Ne))}}),Ge=v(Ve,[["__scopeId","data-v-d21cf599"]]),$=F(null),R=F(!1),U="https://unpkg.com/@ffmpeg/core@0.13.0/dist/esm",O="https://unpkg.com/@ffmpeg/core@0.13.0/dist/umd",Ke="https://unpkg.com/@ffmpeg/ffmpeg@0.13.0/dist/esm/worker.js";async function j(t,e){const n=await fetch(t,{credentials:"omit"});if(!n.ok)throw new Error(`Fetch failed: ${t} → ${n.status}`);const a=await n.arrayBuffer();return URL.createObjectURL(new Blob([a],{type:e}))}async function M(t,e,n){try{return await j(t,n)}catch{return await j(e,n)}}async function ze(){if(R.value&&$.value)return $.value;const t=await se(()=>import("./index-Bsyy57cj.js"),[],import.meta.url),e=typeof(t==null?void 0:t.FFmpeg)=="function",n=typeof(t==null?void 0:t.createFFmpeg)=="function";if(e){const a=await M("/ffmpeg/esm/ffmpeg-core.js",`${U}/ffmpeg-core.js`,"text/javascript"),s=await M("/ffmpeg/esm/ffmpeg-core.wasm",`${U}/ffmpeg-core.wasm`,"application/wasm"),o=await M("/ffmpeg/esm/worker.js",Ke,"text/javascript"),r=new t.FFmpeg;await r.load({coreURL:a,wasmURL:s,workerURL:o}),$.value={writeFile:(l,i)=>r.writeFile(l,i),readFile:l=>r.readFile(l),exec:l=>r.exec(l),setProgress:l=>r.on("progress",i=>l(typeof(i==null?void 0:i.progress)=="number"?i.progress:0))}}else if(n){let a="/ffmpeg/umd/ffmpeg-core.js";try{(await fetch(a,{method:"HEAD"})).ok||(a=`${O}/ffmpeg-core.js`)}catch{a=`${O}/ffmpeg-core.js`}const s=t.createFFmpeg({log:!1,corePath:a});await s.load(),$.value={writeFile:async(o,r)=>{s.FS("writeFile",o,r)},readFile:async o=>s.FS("readFile",o),exec:o=>s.run(...o),setProgress:o=>s.setProgress(r=>o(typeof(r==null?void 0:r.ratio)=="number"?r.ratio:0))}}else throw new Error("FFmpeg export not found");return R.value=!0,$.value}const We={mp3:"libmp3lame",m4a:"aac",wav:"pcm_s16le",flac:"flac",ogg:"libvorbis"};async function qe(t,{format:e,bitrateKbps:n,gainDb:a},s){const o=await ze(),r="input."+(t.name.split(".").pop()||"dat"),l=`output.${e}`;o.setProgress(s);const i=["-i",r,"-af",`volume=${a}dB`,...n?["-b:a",`${n}k`]:[],"-c:a",We[e]??"copy","-f",e,"-y",l];await o.writeFile(r,new Uint8Array(await t.arrayBuffer())),await o.exec(i);const d=await o.readFile(l);return s(1),d}function Ze(t){return t.replace(/[/\\?%*:|"<>]/g,"_")}function He(t,e,n,a){const s=URL.createObjectURL(new Blob([t],{type:a})),o=document.createElement("a");o.href=s,o.download=Ze(`${e}.${n}`),o.style.display="none",document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),URL.revokeObjectURL(s)},0)}const Xe=["disabled"],Je=g({__name:"ConvertBtn",setup(t){const e=b();async function n(){var a;if(e.file)try{e.setLoading(!0),e.setProgress(0);const s=await qe(e.file,{format:e.format,bitrateKbps:e.bitrateKbps,gainDb:e.gainDb},r=>e.setProgress(r)),o=((a=B.find(r=>r.value===e.format))==null?void 0:a.mime)||"audio/*";He(new Blob([s],{type:o}),e.file.name.replace(/\.[^.]+$/,""),e.format,o)}catch(s){console.error(s),e.setError(s.message)}finally{e.setLoading(!1),e.setProgress(0)}}return(a,s)=>(f(),m("button",{class:"btn",disabled:!u(e).hasFile||u(e).loading,onClick:n,"aria-label":"Convert and download"},_(u(e).loading?"Converting…":"Convert & Download"),9,Xe))}}),Qe=v(Je,[["__scopeId","data-v-0f0e51ec"]]),Ye={key:0,class:"overlay",role:"alert","aria-live":"assertive"},et={class:"box"},tt={class:"bar"},at={class:"percent"},st=g({__name:"ProgressOverlay",setup(t){const e=b(),n=w(()=>e.progress*100);return(a,s)=>u(e).loading?(f(),m("div",Ye,[c("div",et,[s[0]||(s[0]=c("p",{class:"label"},"Processing…",-1)),c("div",tt,[c("div",{class:"fill",style:ne({width:n.value+"%"})},null,4)]),c("p",at,_(n.value.toFixed(0))+"%",1)])])):A("",!0)}}),nt=v(st,[["__scopeId","data-v-6777d149"]]),ot={class:"wrapper"},rt={class:"import"},it={key:0,class:"file-msg"},lt=g({__name:"MainLayout",setup(t){const{isMobile:e}=re(),n=b();return(a,s)=>(f(),m("div",ot,[c("main",{class:k(["layout",{mobile:u(e)}])},[c("section",rt,[h(ce),u(n).hasFile?(f(),m("p",it,[s[0]||(s[0]=oe(" File loaded: ")),c("strong",null,_(u(n).fileName),1)])):A("",!0)]),c("section",{class:k(["controls",{mobile:u(e)}])},[h(we),h($e),h(Pe),c("div",{class:k(["format-row",{mobile:u(e)}])},[h(Be),h(Oe)],2),c("div",{class:k(["action-row",{mobile:u(e)}])},[h(Ge),h(Qe)],2)],2),h(nt)],2)]))}}),ut=v(lt,[["__scopeId","data-v-9cb6c194"]]);export{ut as default};
